USE MASTER 
GO

IF DB_ID('DB_GESTOR_NOTAS') IS NOT NULL
BEGIN
	DROP DATABASE DB_GESTOR_NOTAS
END
GO

CREATE DATABASE DB_GESTOR_NOTAS
GO

USE DB_GESTOR_NOTAS
GO

CREATE TABLE TB_USUARIO(
	ID_USUARIO INT IDENTITY(1,1) PRIMARY KEY,
	NOMBRE_USUARIO VARCHAR(50) NOT NULL,
	APELLIDO_USUARIO VARCHAR(50) NOT NULL,
	EMAIL VARCHAR(50) UNIQUE NOT NULL,
	CONTRASENIA NVARCHAR(255) NOT NULL,
	ROL CHAR(1) CHECK (ROL IN ('P', 'E', 'A')),
	FLGELIMINADO BIT DEFAULT 0
)
GO

CREATE TABLE TB_GRADOS (
    ID_GRADO INT IDENTITY(1,1) PRIMARY KEY,
    NOMBRE_GRADO VARCHAR(50) NOT NULL UNIQUE
)

CREATE TABLE TB_CURSOS(
	ID_CURSO CHAR(7) PRIMARY KEY,
	NOMBRE_CURSO VARCHAR(50) NOT NULL Unique,
	ID_PROFESOR INT NOT NULL,
	ID_GRADO INT NOT NULL,
	FOREIGN KEY (ID_PROFESOR) REFERENCES TB_USUARIO(ID_USUARIO),
	FOREIGN KEY (ID_GRADO) REFERENCES TB_GRADOS(ID_GRADO)
)
GO

CREATE TABLE TB_ESTUDIANTES_CURSOS(
	ID_CURSO CHAR(7) NOT NULL,
	ID_USUARIO INT NOT NULL,
	PRIMARY KEY (ID_CURSO, ID_USUARIO),
	FOREIGN KEY (ID_USUARIO) REFERENCES TB_USUARIO (ID_USUARIO),
	FOREIGN KEY (ID_CURSO) REFERENCES TB_CURSOS (ID_CURSO)
)
GO

CREATE TABLE TB_NOTAS (
    ID_NOTA INT IDENTITY(1,1) PRIMARY KEY,
    ID_CURSO CHAR(7) NOT NULL,
    ID_USUARIO INT NOT NULL,
    CALIFICACION DECIMAL(5,2) NOT NULL,
    COMENTARIO VARCHAR(255),
    FECHA_REGISTRO DATE DEFAULT GETDATE(),
    FOREIGN KEY (ID_CURSO) REFERENCES TB_CURSOS(ID_CURSO),
    FOREIGN KEY (ID_USUARIO) REFERENCES TB_USUARIO(ID_USUARIO)
)

-- Profesores (ROL = 'P')
INSERT INTO TB_USUARIO (NOMBRE_USUARIO, APELLIDO_USUARIO, EMAIL, CONTRASENIA, ROL)
VALUES 
('Carlos', 'Ramirez', 'carlos.ramirez@escuela.edu', '$2a$10$fw4ddVa2No5lkadsiYvj0um84MhWs6UCrKRzTtJxNH95lFLAKKay2', 'P'),--pass123
('Laura', 'Gomez', 'laura.gomez@escuela.edu', '$$2a$10$gCUQ8/nZJgvl.ipe7J8drudc1hJsnxTbKQi8YtOZbHrVq7.mWSai6', 'P'),--pass456

('Miguel', 'Torres', 'miguel.torres@estudiante.edu', '$2a$10$CshOmN5jewOXXTpExmtlM.jKXg/Fm6utGRKAQDcmPUOhUVMXYpq0.', 'E'),--pass789
('Ana', 'Martinez', 'ana.martinez@estudiante.edu', '$2a$10$.8484niRiAaCZsZlq23daevCgZ68ay9dEpRT8Zn44EmnKCKRymL0O', 'E'),--pass321
('Luis', 'Sanchez', 'luis.sanchez@estudiante.edu', '$2a$10$rh1TdLDmVeLE393mOtVmZOBZhP7LTDhmmYkq4DbK8qomkf1UXZmQq', 'E'),--	pass654

('Admin', 'Sistema', 'admin@gestor.edu', '$2a$10$14sTjoyRGcXXeifh2tteD.6zF0KjosvSJUSKNn7EdM/KLU/BpT96y', 'A');--adminpass

--Grados
INSERT INTO TB_GRADOS (NOMBRE_GRADO)
VALUES 
('Primero de Secundaria'),
('Segundo de Secundaria'),
('Tercero de Secundaria');

-- Cursos
INSERT INTO TB_CURSOS (ID_CURSO, NOMBRE_CURSO, ID_PROFESOR, ID_GRADO)
VALUES
('MAT101A', 'Matemáticas I', 1, 1),
('LEN102B', 'Lengua y Literatura', 2, 1),
('FIS201A', 'Física', 1, 2),
('HIS202B', 'Historia', 2, 2);

-- Estudiantes_Cursos
INSERT INTO TB_ESTUDIANTES_CURSOS (ID_CURSO, ID_USUARIO)
VALUES
('MAT101A', 3),
('MAT101A', 4),
('LEN102B', 3),
('LEN102B', 5),
('FIS201A', 4),
('HIS202B', 5);

--Notas
INSERT INTO TB_NOTAS (ID_CURSO, ID_USUARIO, CALIFICACION, COMENTARIO)
VALUES
('MAT101A', 3, 15.50, 'Buen rendimiento'),
('MAT101A', 4, 17.25, 'Excelente trabajo'),
('LEN102B', 3, 14.00, 'Debe mejorar la redacción'),
('LEN102B', 5, 18.00, 'Participación destacada'),
('FIS201A', 4, 13.75, 'Entregó todas las prácticas'),
('HIS202B', 5, 19.00, 'Gran presentación final');
